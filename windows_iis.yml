---
- name: install iis
  win_feature:
    name: Web-Server
    state: present
  notify: iis_running

- name: Insert webpage formatting
  win_copy:
    src: website/
    dest: C:\Inetpub\wwwroot\

- name: Copy Cert
  win_copy:
    src: /certs/certificate.pfx
    dest: C:\Inetpub\wwwroot\web_certificate.pfx

- name: remove cert
  win_certificate_store:
    state: absent
    thumbprint: 894B7A63E5CC9C9A99C4A777104EDCC91054808A

- name: install certificate 
  win_certificate_store:
    path: C:\Inetpub\wwwroot\web_certificate.pfx
    file_type: pkcs12
    state: present
    password: "{{ windowspassword }}"
    store_name: Root
  register: thumbprint

- name: Add a HTTPS binding
  win_iis_webbinding:
    name: "Tower SSL"
    certificate_store_name: Root
    protocol: https
    port: 443
    certificate_hash: "{{ thumbprint.thumbprints[0] }}"
    state: present
             
#Need to verify when switching to collections
- name: Insert Index Page for webpage
  win_template:
    src: templates/indexcomplex.html.j2
    dest: C:\Inetpub\wwwroot\index.html
  tags:
    - updatewin   
