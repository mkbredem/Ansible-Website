---
- name: install iis
  win_feature:
    name: Web-Server
    state: present
  notify: iis_running

- name: Insert webpage formatting
  win_copy:
    src: website/
    dest: C:\Inetpub\wwwroot\

- name: Copy Cert
  win_copy:
    src: /certs/shadowman_cert.cer
    dest: C:\Inetpub\wwwroot\web_cert.cer

- name: Copy Key
  win_copy:
    src: /certs/shadowman_private.key
    dest: C:\ProgramData\Microsoft\Crypto\RSA\MachineKeys\web_cert.key

- name: install certificate 
  win_certificate_store:
    path: C:\Inetpub\wwwroot\web_cert.cer
    state: present
    store_name: Root
  register: thumbprint

- name: Add a HTTPS binding
  win_iis_webbinding:
    name: Default Web Site
    certificate_store_name: "Root"
    protocol: https
    port: 443
    certificate_hash: "{{ thumbprint.thumbprints[0] }}"
    state: present
             
#Need to verify when switching to collections
- name: Insert Index Page for webpage
  win_template:
    src: templates/indexcomplex.html.j2
    dest: C:\Inetpub\wwwroot\index.html
  tags:
    - updatewin   
